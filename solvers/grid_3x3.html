<script>

	let c = 2;
	let r = 0;
	let dc = 2;
	let dr = 0;
	let rc = 1;
	let rr = 1;
	let uc = 0;
	let ur = 2;
	let Rc = 2;
	let Rr = 0;
	let Lc = 1;
	let Lr = 2;
	
	function state() {
		return '' + c + r + dc + dr + rc + rr + uc + ur + Rc + Rr + Lc + Lr;
	}

	function expand(s) {
		c  = parseInt(s.at(0));
		r  = parseInt(s.at(1));
		dc = parseInt(s.at(2));
		dr = parseInt(s.at(3));
		rc = parseInt(s.at(4));
		rr = parseInt(s.at(5));
		uc = parseInt(s.at(6));
		ur = parseInt(s.at(7));
		Rc = parseInt(s.at(8));
		Rr = parseInt(s.at(9));
		Lc = parseInt(s.at(10));
		Lr = parseInt(s.at(11));
	}

	function hazard() {
		// if (c === 1 && r === 2) {
		// 	if (rc === c && rr === r) return false;
		// 	if (uc === c && ur === r) return false;
		// 	if (Lc === c && Lr === r) return false;
		// 	if (Rc === c && Rr === r) return false;
		// 	return true;
		// }
		if (c === 2 && r === 2) {
			if (uc === c && ur === r) return false;
			if (Lc === c && Lr === r) return false;
			return true;
		}
		return false;
	}

	function goal() {
		if (c === 0 && r === 2) {
			if (dc === c && dr === r) return false;
			if (rc === c && rr === r) return false;
			if (uc === c && ur === r) return false;
			if (Rc === c && Rr === r) return false;
			return true;
		}
		return false;
	}

	const moves = ['left', 'right', 'up', 'down'];

	function can(move) {
		if (move === 'left') {
			if (c === 0) return false;
			if (dr === r && dc === c - 1) return false;
			if (rr === r && rc === c - 1) {
				if (dc === c && dr === r) return false;
				if (uc === c && ur === r) return false;
				if (Rc === c && Rr === r) return false;
			}
			if (ur === r && uc === c - 1) return false;
			if (Lr === r && Lc === c - 1) return false;
			return true;
		} else if (move === 'right') {
			if (c === 2) return false;
			if (dr === r && dc === c + 1) return false;
			if (rr === r && rc === c + 1) return false;
			if (ur === r && uc === c + 1) return false;
			if (Rr === r && Rc === c + 1) return false;
			return true;
		} else if (move === 'up') {
			if (r === 0) return false;
			if (dr === r && dc === r - 1) {
				if (rc === c && rr === r) return false;
				if (Lc === c && Lr === r) return false;
				if (Rc === c && Rr === r) return false;
			}
			if (rc === c && rr === r - 1) return false;
			if (uc === c && ur === r - 1) return false;
			if (Lc === c && Lr === r - 1) return false;
			if (Rc === c && Rr === r - 1) return false;
			return true;
		} else if (move === 'down') {
			if (r === 2) return false;
			if (dc === c && dr === r + 1) return false;
			if (rc === c && rr === r + 1) return false;
			if (uc === c && ur === r + 1) {
				if (rc === c && rr === r) return false;
				if (Lc === c && Lr === r) return false;
				if (Rc === c && Rr === r) return false;
			}
			if (Lc === c && Lr === r + 1) return false;
			if (Rc === c && Rr === r + 1) return false;
			return true;
		} else {
			throw new Error('invalid move');
		}
	}

	function go(move) {
		if (move === 'left') {
			if (dc === c && dr === r) --dc;
			if (rc === c && rr === r) --rc;
			if (uc === c && ur === r) --uc;
			if (Rc === c && Rr === r) --Rc;
			--c;
		} else if (move === 'right') {
			if (dc === c && dr === r) ++dc;
			if (rc === c && rr === r) {
				if (Lc === c && Lr === r) ++rc;
			}
			if (uc === c && ur === r) ++uc;
			if (Lc === c && Lr === r) ++Lc;
			++c;
		} else if (move === 'up') {
			if (dc === c && dr === r) --dr;
			if (rc === c && rr === r) --rr;
			if (uc === c && ur === r) {
				if (Rc === c && Rr === r || Lc === c && Lr === r) --ur;
			}
			if (Lc === c && Lr === r) --Lr;
			if (Rc === c && Rr === r) --Rr;
			--r;
		} else if (move === 'down') {
			if (dc === c && dr === r) {
				if (Lc === c && Lr === r || Rc === c && Rr === r) ++dr;
			}
			if (rc === c && rr === r) ++rr;
			if (uc === c && ur === r) ++ur;
			if (Lc === c && Lr === r) ++Lr;
			if (Rc === c && Rr === r) ++Rr;
			++r;
		} else {
			throw new Error('invalid move');
		}
	}

	/////////////////////////////////////////////////////////////////////////////
	//
	// start generic code
	//
	/////////////////////////////////////////////////////////////////////////////

	const paths = new Map();
	paths.set(state(), []); // initial state
	solution = null;
	let visits = 0;

	function visit(s) {
		++visits;
		const p = paths.get(s);
		if (solution !== null && solution.length <= p.length + 1) {
			return;
		}
		const child_states = [];
		moves.forEach(move => {
			expand(s);
			if (can(move)) {
				go(move);
				if (hazard()) return;
				if (paths.has(state()) && paths.get(state()).length <= p.length + 1) return;
				paths.set(state(), p.concat(move));
				if (goal()) {
					solution = paths.get(state());
				} else {
					child_states.push(state());
				}
			}
		});
		child_states.forEach(s => visit(s));
	}

	visit(state());
	
	document.writeln("<pre>")
//	document.writeln('running with max_path_length ' + max_path_length);
	document.writeln('states visited: ' + visits);
	if (solution === null) {
		document.writeln('solution not found');
	} else {
		document.writeln('moves: ' + solution.length);
		solution.forEach(move => document.writeln(move));
	}
	document.writeln("</pre>")
	
	</script>
	