<script>

const cols      = 2;
const rows      = 4;
const max_depth = 12;

const box_start = new c_cell({ c: 0, r: 0 });
const box_goal  = new c_cell({ c: 0, r: 2 });
const up_start  = new c_cell({ c: 1, r: 1 });

//#region cell

function c_cell(cell) {
	this.c = cell.c;
	this.r = cell.r;
}

c_cell.prototype.key = function() {
	return '' + String(this.c).padStart(2, '0') + String(this.r).padStart(2, '0');
};

c_cell.prototype.eq = function(cell) {
	return this.c === cell.c && this.r === cell.r;
};

c_cell.prototype.left_of = function(cell) {
	return this.c === cell.c - 1 && this.r === cell.r;
};

c_cell.prototype.right_of = function(cell) {
	return this.c === cell.c + 1 && this.r === cell.r;
};

c_cell.prototype.below = function(cell) {
	return this.c === cell.c && this.r === cell.r + 1;
};

c_cell.prototype.above = function(cell) {
	return this.c === cell.c && this.r === cell.r - 1;
};

//#endregion

//#region state

const visited_map = new Map();

function c_state(state) {
	this.box         = new c_cell(state.box);
	this.up          = new c_cell(state.up );
	this.parent      = null;
	this.left_child  = null;
	this.right_child = null;
	this.up_child    = null;
	this.down_child  = null;
}

c_state.prototype.goal = function() {
	return this.box.eq(box_goal) && !this.up.eq(box_goal);
};

c_state.prototype.key = function() {
	return this.box.key() + this.up.key();
};

c_state.prototype.eq = function(state) {
	return this.box.eq(state.box) && this.up.eq(state.up);
};

let done = false;

c_state.prototype.visit_children = function(depth) {
	--depth;
	if (depth === 0) {
		return;
	}
	// visit left
	if (this.box.c > 0 && !this.box.right_of(this.up)) {
		const s = new c_state(this);
		if (this.box.eq(this.up)) --s.up.c;
		--s.box.c;
		if (!visited_map.has(s.key())) {
			this.left_child = s;
			s.parent = this;
			visited_map.set(s.key(), s);
			if (s.goal()) {
				s.print_path();
				done = true;
				return;
			}
			s.visit_children(depth);
			if (done) return;
		}
	}
	// visit right
	if (this.box.c < cols - 1 && !this.box.left_of(this.up)) {
		const s = new c_state(this);
		if (this.box.eq(this.up)) ++s.up.c;
		++s.box.c;
		if (!visited_map.has(s.key())) {
			this.right_child = s;
			s.parent = this;
			visited_map.set(s.key(), s);
			if (s.goal()) {
				s.print_path();
				done = true;
				return false;
			}
			s.visit_children(depth);
			if (done) return;
		}
	}
	// visit up
	if (this.box.r > 0 && !this.box.below(this.up)) {
		const s = new c_state(this);
		--s.box.r;
		if (!visited_map.has(s.key())) {
			this.up_child = s;
			s.parent = this;
			visited_map.set(s.key(), s);
			if (s.goal()) {
				s.print_path();
				done = true;
				return false;
			}
			s.visit_children(depth);
			if (done) return;
		}
	}
	// visit down
	if (this.box.r < rows - 1) {
		const s = new c_state(this);
		if (this.box.eq(this.up)) ++s.up.r;
		++s.box.r;
		if (!visited_map.has(s.key())) {
			this.down_child = s;
			s.parent = this;
			visited_map.set(s.key(), s);
			if (s.goal()) {
				s.print_path();
				done = true;
				return false;
			}
			s.visit_children(depth);
			if (done) return;
		}
	}
};

c_state.prototype.print_path = function(path) {
	if (typeof(path) === 'undefined') {
		path = [];
	}
	if (this === root) {
		document.writeln("<pre>")
		path.reverse().forEach(e => document.writeln('  ' + e));
		document.writeln("\n</pre>")
	} else {
		if      (this === this.parent.left_child ) path.push("left" );
		else if (this === this.parent.right_child) path.push("right");
		else if (this === this.parent.up_child   ) path.push("up"   );
		else if (this === this.parent.down_child ) path.push("down" );
		this.parent.print_path(path);
	}
};

//#endregion

//#region start

const root = new c_state({
	box: box_start,
	up : up_start
});

visited_map.set(root.key(), root);

document.writeln("<pre>")
document.writeln('running with max_depth ' + max_depth);
root.visit_children(max_depth);
if (!done) {
	document.writeln("<pre>")	
	document.write('solution not found');
	document.writeln("\n</pre>")
}
document.writeln("\n</pre>")

//#endregion

</script>
